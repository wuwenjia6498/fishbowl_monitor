# v7.1 ä»»åŠ¡å®Œæˆè®°å½•

## ä»»åŠ¡ç›®æ ‡
ä¸º**è¡Œä¸šæ¿å—**è¡¨æ ¼å¢åŠ "åŒºé—´æ¶¨å¹…"å­—æ®µï¼Œä¸å®½åŸºæŒ‡æ•°ä¿æŒä¸€è‡´ã€‚

## æ‰§è¡Œæƒ…å†µ

### âœ… åç«¯æ£€æŸ¥ (`scripts/etl.py`)
**çŠ¶æ€**ï¼šæ— éœ€ä¿®æ”¹ï¼Œå·²å®Œæˆ

- âœ… ETL è„šæœ¬å·²è®¡ç®— `trend_pct` å­—æ®µï¼ˆç¬¬407-427è¡Œï¼‰
- âœ… æ•°æ®å·²å†™å…¥æ•°æ®åº“ï¼ˆç¬¬644-703è¡Œï¼‰
- âœ… è®¡ç®—é€»è¾‘ï¼šä»ä¿¡å·å‘å‡ºæ—¥ï¼ˆå˜ç›˜æ—¥ï¼‰è‡³ä»Šçš„ç´¯è®¡æ¶¨è·Œå¹…
  ```python
  # å›æº¯åˆ°çŠ¶æ€èµ·å§‹ç‚¹çš„å‰ä¸€å¤©ï¼ˆå˜ç›˜å‰ä¸€å¤©ï¼‰
  start_index = i - duration
  trend_pct = (current_close - start_price) / start_price
  ```

### âœ… å‰ç«¯ä¿®æ”¹ (`components/business/fishbowl-table.tsx`)
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### 1. æ·»åŠ è¡¨å¤´åˆ—ï¼ˆç¬¬573-580è¡Œï¼‰
```tsx
<TableHead className="w-[100px]">
  <HeaderWithTooltip
    title="åŒºé—´æ¶¨å¹…"
    content="ä»ä¿¡å·å‘å‡ºæ—¥(å˜ç›˜æ—¥)è‡³ä»Šçš„ç´¯è®¡æ¶¨è·Œå¹…ï¼Œç”¨äºéªŒè¯è¶‹åŠ¿ç›ˆåˆ©æ€§ã€‚"
    align="right"
  />
</TableHead>
```

#### 2. æ·»åŠ é¢œè‰²é€»è¾‘å‡½æ•°ï¼ˆç¬¬597-603è¡Œï¼‰
```tsx
// v7.1: è®¡ç®—åŒºé—´æ¶¨å¹…çš„é¢œè‰²é€»è¾‘ï¼ˆä¸å®½åŸºæŒ‡æ•°ä¿æŒä¸€è‡´ï¼‰
const getTrendPctColor = () => {
  if (item.trend_pct === null || item.trend_pct === undefined) return 'text-muted-foreground';
  if (item.trend_pct > 0) return 'text-red-500';  // æ­£æ•°ï¼šçº¢è‰²
  if (item.trend_pct < 0) return 'text-green-500'; // è´Ÿæ•°ï¼šç»¿è‰²
  return 'text-muted-foreground'; // é›¶ï¼šç°è‰²
};
```

#### 3. æ·»åŠ æ•°æ®å•å…ƒæ ¼ï¼ˆç¬¬758-765è¡Œï¼‰
```tsx
{/* v7.1: åŒºé—´æ¶¨å¹…ï¼ˆç…§æ¬å®½åŸºæŒ‡æ•°å®ç°ï¼‰ */}
<TableCell className="w-[100px] text-right">
  <span className={`font-mono font-medium ${getTrendPctColor()}`}>
    {item.trend_pct !== null && item.trend_pct !== undefined
      ? `${item.trend_pct > 0 ? '+' : ''}${formatPercentage(item.trend_pct)}`
      : '-'}
  </span>
</TableCell>
```

## å®ç°ç»†èŠ‚

### æ ·å¼è§„èŒƒï¼ˆv6.3 å®ªæ³•ï¼‰
- âœ… **> 0**: ğŸ”´ `text-red-500` + åŠ å·å‰ç¼€ï¼ˆå¦‚ `+5.42%`ï¼‰
- âœ… **< 0**: ğŸŸ¢ `text-green-500`ï¼ˆå¦‚ `-2.18%`ï¼‰
- âœ… **= 0**: ç°è‰² `text-muted-foreground`
- âœ… **null/undefined**: æ˜¾ç¤º `-`

### æ ¼å¼åŒ–å‡½æ•°
ä½¿ç”¨ç°æœ‰çš„ `formatPercentage()` å‡½æ•°ï¼š
- å°äº 0.01% æ—¶ä¿ç•™ 3 ä½å°æ•°
- å…¶ä»–æƒ…å†µä¿ç•™ 2 ä½å°æ•°

### åˆ—é¡ºåº
```
æ¿å—åç§° â†’ ETFæ ‡çš„ â†’ é€»è¾‘ â†’ æŒä»“ â†’ è¿‘æœŸè¶‹åŠ¿ â†’ ç°ä»·&MA20 â†’ å½“æ—¥æ¶¨å¹… â†’ çŠ¶æ€ â†’ [åŒºé—´æ¶¨å¹… ğŸ†•] â†’ åç¦»åº¦
```

## éªŒè¯ç»“æœ

- âœ… TypeScript ç¼–è¯‘é€šè¿‡ï¼ˆæ—  linter é”™è¯¯ï¼‰
- âœ… é€»è¾‘å®Œå…¨ç…§æ¬å®½åŸºæŒ‡æ•°å®ç°
- âœ… æ ·å¼ä¸é…è‰²ä¿æŒä¸€è‡´
- âœ… Tooltip æç¤ºä¿¡æ¯æ¸…æ™°

## æ•ˆæœé¢„è§ˆ

### å®½åŸºæŒ‡æ•°è¡¨æ ¼ï¼ˆå‚è€ƒæ ‡å‡†ï¼‰
```
åŒºé—´æ¶¨å¹…: +5.42%  ï¼ˆçº¢è‰²ï¼Œç­‰å®½å­—ä½“ï¼‰
åŒºé—´æ¶¨å¹…: -2.18%  ï¼ˆç»¿è‰²ï¼Œç­‰å®½å­—ä½“ï¼‰
åŒºé—´æ¶¨å¹…: -       ï¼ˆæ— æ•°æ®ï¼Œç°è‰²ï¼‰
```

### è¡Œä¸šæ¿å—è¡¨æ ¼ï¼ˆæ–°å¢ï¼‰
```
åŒºé—´æ¶¨å¹…: +3.95%  ï¼ˆçº¢è‰²ï¼Œç­‰å®½å­—ä½“ï¼‰
åŒºé—´æ¶¨å¹…: -1.23%  ï¼ˆç»¿è‰²ï¼Œç­‰å®½å­—ä½“ï¼‰
åŒºé—´æ¶¨å¹…: -       ï¼ˆæ— æ•°æ®ï¼Œç°è‰²ï¼‰
```

## ç”¨æˆ·ä½“éªŒ

1. **ä¸€è‡´æ€§**ï¼šä¸å®½åŸºæŒ‡æ•°è¡¨æ ¼å®Œå…¨ä¸€è‡´çš„è§†è§‰ä½“éªŒ
2. **å¯è¯»æ€§**ï¼šç­‰å®½å­—ä½“ï¼Œæ­£è´Ÿå·æ¸…æ™°ï¼Œçº¢ç»¿é…è‰²ç¬¦åˆä¸­å›½å¸‚åœºä¹ æƒ¯
3. **ä¿¡æ¯å¯†åº¦**ï¼šå¢åŠ ä¸€åˆ—ä½†ä¸å½±å“æ•´ä½“å¸ƒå±€
4. **Tooltip**ï¼šé¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†è¯´æ˜

---

**å®Œæˆæ—¶é—´**ï¼š2025-12-29  
**ç‰ˆæœ¬**ï¼šv7.1  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆï¼Œå¾…ç”¨æˆ·éªŒè¯

