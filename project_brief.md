# ðŸ§­ é¡¹ç›®åç§°ï¼šé±¼ç›†Â·ETF è¶‹åŠ¿ç½—ç›˜ (Fishbowl ETF Compass)
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v5.0 (Final Combat Version)
**æ ¸å¿ƒå®šä½ï¼š** å…¨å¤©å€™ ETF å®žæˆ˜äº¤æ˜“è¾…åŠ©ç³»ç»Ÿ
**æ•°æ®æºï¼š** Tushare Pro (æ··åˆåŒè½¨åˆ¶)
**æ ¸å¿ƒä»·å€¼ï¼š** æ‘’å¼ƒå™ªéŸ³ï¼ŒåŸºäºŽâ€œé±¼ç›†æ¨¡åž‹â€æä¾›å¤§åŠ¿ç ”åˆ¤ã€ETF æ·±åº¦è§£æžä¸Žå®žæˆ˜äº¤æ˜“ä¿¡å·ã€‚

---

## 1. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ (Business Logic)

### 1.1 é±¼ç›†è¶‹åŠ¿æ¨¡åž‹
* **ä¸´ç•Œå€¼ (MA20):** `CLOSE.rolling(20).mean()` (ETF æ•°æ®å¿…é¡»å‰å¤æƒ `adj='qfq'`)
* **çŠ¶æ€ (Status):**
    * ðŸ”´ **YES (å¤šå¤´):** `Price > MA20 * 1.01`
    * ðŸŸ¢ **NO (ç©ºå¤´):** `Price < MA20 * 0.99`
    * ðŸŸ¡ **Hold (éœ‡è¡):** Â±1% ç¼“å†²å¸¦å†…ç»´æŒåŽŸåˆ¤ã€‚
* **è¶‹åŠ¿ç»©æ•ˆ (Trend Performance):**
    * è®¡ç®—ä»Žå½“å‰çŠ¶æ€ (YES/NO) **èµ·å§‹æ—¥** è‡³ä»Šçš„ç´¯è®¡æ¶¨è·Œå¹…ã€‚
    * **é€»è¾‘:** éªŒè¯è¶‹åŠ¿çš„ç›ˆåˆ©æ€§ï¼ˆçœŸçªç ´è¿˜æ˜¯å‡æ‘”ï¼‰ã€‚

### 1.2 æ•°æ®åŒè½¨åˆ¶ (Hybrid Data Model)
ç³»ç»Ÿé‡‡ç”¨ **â€œæŒ‡æ•°çœ‹é£Žå‘ï¼ŒETF åšäº¤æ˜“â€** çš„æ··åˆæ¨¡å¼ï¼š

1.  **å®½åŸºå¤§åŠ¿ (Broad):**
    * **å¯¹è±¡:** åŽŸç”ŸæŒ‡æ•° (Indices)ï¼Œå¦‚ `000300.SH`ã€‚
    * **ç›®çš„:** çº¯ç²¹çš„å¤§ç›˜é£Žå‘æ ‡å°ºï¼Œä¸ç›´æŽ¥äº¤æ˜“ã€‚
    * **æ•°æ®æº:** `pro.index_daily`ã€‚
2.  **è¡Œä¸šè½®åŠ¨ (Industry):**
    * **å¯¹è±¡:** äº¤æ˜“åž‹ ETF (Funds)ï¼Œå¦‚ `512480.SH`ã€‚
    * **ç›®çš„:** ç›´æŽ¥äº¤æ˜“æ ‡çš„ã€‚
    * **æ•°æ®æº:** `pro.fund_daily(adj='qfq')`ã€‚
    * **é…ç½®:** åŸºäºŽ `CUSTOM_ETF_POOL` ç¡¬ç¼–ç é…ç½®è¡¨ã€‚

### 1.3 å¸‚åœºæ°”å€™çœ‹æ¿ (Cockpit)
é¡¶éƒ¨çœ‹æ¿å±•ç¤ºå®è§‚ä¸Žå¾®è§‚çš„åŒé‡æ¸©åº¦ï¼š
* **å¤§ç›˜é£Žå‘ (Macro Trend):** åŸºäºŽæ²ªæ·±300æŒ‡æ•°çš„çŠ¶æ€åˆ¤å®š (è¿›æ”»/éœ‡è¡/é˜²å®ˆ)ã€‚
* **å¸‚åœºçƒ­åº¦ (Market Heat):** ç»Ÿè®¡ ETF æ± ä¸­å¤„äºŽ YES çŠ¶æ€çš„æ¯”ä¾‹ (å¤šå¤´çŽ‡)ã€‚

---

## 2. æ•°æ®åº“è®¾è®¡ (Schema)

### 2.1 èµ„äº§é…ç½®è¡¨ (`monitor_config`)
å­˜å‚¨ç¡¬ç¼–ç çš„èµ„äº§æ± ï¼Œæ”¯æŒåˆ†ç»„ä¸Žæ·±åº¦é€»è¾‘ã€‚

```sql
CREATE TABLE monitor_config (
    symbol VARCHAR(20) PRIMARY KEY,       -- ä»£ç  (æŒ‡æ•°æˆ–ETF)
    name VARCHAR(50) NOT NULL,            -- æ˜¾ç¤ºåç§° (å¦‚ "äººå·¥æ™ºèƒ½")
    category VARCHAR(20) NOT NULL,        -- 'broad' æˆ– 'industry'
    
    -- åˆ†ç»„ä¸ŽæŽ’åº
    industry_level VARCHAR(50),           -- åˆ†ç»„å (å¦‚ "ç§‘æŠ€ (TMT)", "å®½åŸºæŒ‡æ•°")
    sort_rank INT,                        -- å›ºå®šæŽ’åºæƒé‡ (å¦‚ 101, 102...)
    
    -- äº¤æ˜“ä¸Žæ·±åº¦ä¿¡æ¯
    dominant_etf VARCHAR(50),             -- ETF åç§°æ ‡ç­¾ (å¦‚ "äººå·¥æ™ºèƒ½ETF")
    investment_logic TEXT,                -- [Markdown] æ·±åº¦æŠ•èµ„é€»è¾‘/è§„æ¨¡/æŒä»“åˆ†æž
    
    is_active BOOLEAN DEFAULT true,
    is_system_bench BOOLEAN DEFAULT false
);

### 2.2 æ¯æ—¥è¡Œæƒ…è¡¨ (fishbowl_daily)
SQL
CREATE TABLE fishbowl_daily (
    id SERIAL PRIMARY KEY,
    date DATE NOT NULL,
    symbol VARCHAR(20) REFERENCES monitor_config(symbol),
    close_price DECIMAL(10, 2) NOT NULL,
    ma20_price DECIMAL(10, 4) NOT NULL,
    status VARCHAR(10) NOT NULL,          -- YES/NO
    
    change_pct DECIMAL(10, 4),            -- å½“æ—¥æ¶¨è·Œå¹…
    trend_pct DECIMAL(10, 4),             -- [æ ¸å¿ƒ] è¶‹åŠ¿ç´¯è®¡æ¶¨å¹…
    deviation_pct DECIMAL(10, 4),         -- åç¦»åº¦
    duration_days INT NOT NULL,           -- æŒç»­å¤©æ•°
    
    signal_tag VARCHAR(20),               -- æˆ˜æœ¯æ ‡ç­¾ (å¯åŠ¨/ä¸»å‡/è¿‡çƒ­/è¶…è·Œ)
    UNIQUE(symbol, date)
);


## 3. Python ETL è§„èŒƒ

### 3.1 åˆå§‹åŒ–ç­–ç•¥ (`init_db.py`)
- å®Œå…¨æ”¾å¼ƒç”³ä¸‡è‡ªåŠ¨æŠ“å–ï¼Œè½¬ä¸º**æ³¨å…¥ç²¾é€‰èµ„äº§æ± **ã€‚
- **å®½åŸºæ± **ï¼šå›ºå®šä¸º ä¸Šè¯50ã€æ²ªæ·±300ã€åˆ›ä¸šæ¿ã€ç§‘åˆ›50ã€ä¸­è¯500ã€ä¸­è¯1000ã€ä¸­è¯2000ã€åŒ—è¯50ã€‚
- **è¡Œä¸šæ± **ï¼šå‚ç…§ã€ŠAè‚¡ä¸»æµæ¿å—ä¸ŽETFå¯¹ç…§è¡¨ã€‹PDFå†…å®¹ï¼Œç¡¬ç¼–ç é…ç½®ï¼š
    - **åˆ†ç»„**ï¼šç§‘æŠ€(TMT)ã€é«˜ç«¯åˆ¶é€ ã€åŒ»è¯æ¶ˆè´¹ã€å‘¨æœŸèµ„æºã€é‡‘èžã€‚
    - **å†…å®¹**ï¼šæå–PDFä¸­çš„â€œæ ¸å¿ƒæŠ•èµ„é€»è¾‘ä¸Žå…³é”®è¯â€æ³¨å…¥ `investment_logic` å­—æ®µã€‚
    - **æŽ’åº**ï¼šç”¨ `sort_rank` ä¸¥æ ¼å®šä¹‰å±•ç¤ºé¡ºåºã€‚

### 3.2 æ¯æ—¥è®¡ç®— (`etl.py`)
- **æ··åˆæŠ“å–**ï¼šæ ¹æ® `category` è‡ªåŠ¨åˆ‡æ¢ `index_daily` (å®½åŸº) å’Œ `fund_daily` (è¡Œä¸š)ã€‚
- **åŒºé—´å›žæº¯**ï¼š`trend_pct` æŒ‰ `[date - duration_days]` çš„æ”¶ç›˜ä»·ä¸ºåŸºå‡†å›žæº¯è®¡ç®—ã€‚

---

## 4. å‰ç«¯å±•ç¤ºè§„èŒƒ (UI Specifications)

### 4.1 å¸ƒå±€ç»“æž„
- **Title**: é±¼ç›†Â·ETF è¶‹åŠ¿ç½—ç›˜
- **Header**: ç®€å•åŒç»´çœ‹æ¿ï¼ˆå·¦ï¼šå¤§ç›˜é£Žå‘ Badge / å³ï¼šå¸‚åœºçƒ­åº¦ Progressï¼‰

### 4.2 [ðŸ›ï¸ å®½åŸºå¤§åŠ¿] Tab
- **é€»è¾‘**ï¼šçº¯æŒ‡æ•°ç›‘æŽ§ï¼Œæ—  ETF å¤åˆ¶åŠŸèƒ½
- **åˆ—å®šä¹‰**ï¼š
    - æŒ‡æ•°åç§°ï¼ˆTooltipè§£é‡Šï¼‰
    - çŽ°ä»·ï¼ˆä¸Šæ–¹çŽ°ä»· / ä¸‹æ–¹ MA20ï¼‰
    - å½“æ—¥æ¶¨å¹…ï¼ˆChange %ï¼‰
    - çŠ¶æ€ï¼ˆYES/NO Badgeï¼‰
    - åŒºé—´æ¶¨å¹…ï¼ˆTrend Performanceï¼Œæ ¸å¿ƒéªŒè¯æŒ‡æ ‡ï¼Œçº¢/ç»¿é«˜äº®ï¼‰
    - åç¦»åº¦

### 4.3 [ðŸ­ è¡Œä¸šè½®åŠ¨] Tab
- **é€»è¾‘**ï¼šç»“æž„åŒ–åˆ†ç»„å±•ç¤ºï¼ˆGrouped Viewï¼‰ï¼ŒéžæŽ’åæ¨¡å¼
- **æ¸²æŸ“**ï¼šæŒ‰ `industry_level` åˆ†ç»„ï¼Œæ¸²æŸ“å¸¦æ ‡é¢˜å­è¡¨æ ¼
- **åˆ—å®šä¹‰**ï¼š
    - æ¿å—åç§° (name)
    - ETFåç§° (dominant_etf)
    - ETFä»£ç  (symbol)
        - åŠŸèƒ½Aï¼šç‚¹å‡»ä»£ç å¤åˆ¶åˆ°å‰ªè´´æ¿
        - åŠŸèƒ½Bï¼šç‚¹å‡» â„¹ï¸ å›¾æ ‡å‘¼å‡ºä¾§è¾¹æ ï¼ˆSheetï¼‰ï¼Œå±•ç¤º Markdown æŠ•èµ„é€»è¾‘
    - çŽ°ä»· & MA20
    - çŠ¶æ€ (YES/NO)
    - çƒ­åº¦ï¼ˆåç¦»åº¦ï¼‰
    - ä¿¡å·ï¼ˆå¯åŠ¨/ä¸»å‡/è¿‡çƒ­â€¦ï¼‰

---

## 5. äº¤äº’ç»†èŠ‚ (UX)
- **Tooltips**ï¼šè¡¨å¤´å­—æ®µéœ€æœ‰ (?) æç¤ºï¼Œè§£é‡Šâ€œåŒºé—´æ¶¨å¹…â€ã€â€œé±¼ç›†çŠ¶æ€â€ç­‰ä¸“ä¸šåè¯
- **Toast**ï¼šå¤åˆ¶ ETF ä»£ç æ—¶æœ‰åé¦ˆ
- **Sheet**ï¼šæ·±åº¦é€»è¾‘æ”¯æŒ Markdown æ¸²æŸ“ï¼ˆåŠ ç²—/åˆ—è¡¨ï¼‰